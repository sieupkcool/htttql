{% extends "base.html" %} {% block title %}Chi tiáº¿t Ä‘á» thi{% endblock %} {%
block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>ğŸ“„ Chi tiáº¿t Ä‘á» thi</h2>
  <a href="/bomon" class="btn btn-secondary">â¬…ï¸ Quay láº¡i</a>
</div>
<div id="thongTinDeThi" class="info-box mb-4 shadow-sm"></div>
<div id="danhSachCauHoi" class="mb-4">
  <h4 class="mb-3">ğŸ“š Danh sÃ¡ch cÃ¢u há»i</h4>
  <ul class="list-group shadow-sm">
    <li class="list-group-item">Äang táº£i cÃ¢u há»i...</li>
  </ul>
</div>
<div class="d-flex gap-3">
  <button class="btn btn-warning px-4" onclick="suaDeThi()">ğŸ–Šï¸ Sá»­a Ä‘á» thi</button>
  <button class="btn btn-danger px-4" onclick="xoaDeThi()">ğŸ—‘ï¸ XÃ³a Ä‘á» thi</button>
</div>
{% endblock %} {% block scripts %}
<script>
  const urlParams = new URLSearchParams(window.location.search);
  const deThi = urlParams.get("de");
  const boMon = urlParams.get("mon");

  const thongTin = document.getElementById("thongTinDeThi");
  const danhSach = document
    .getElementById("danhSachCauHoi")
    .querySelector("ul");

  if (deThi && boMon) {
    thongTin.innerHTML = `
      <h4 class="mb-3">ğŸ“ ${deThi}</h4>
      <p><strong>Bá»™ mÃ´n:</strong> ${decodeURIComponent(boMon)}</p>
      <p><strong>MÃ´ táº£:</strong> ÄÃ¢y lÃ  Ä‘á» thi thuá»™c há»c pháº§n <em>${decodeURIComponent(
        boMon
      )}</em>. Äá» kiá»ƒm tra kiáº¿n thá»©c chuyÃªn sÃ¢u liÃªn quan Ä‘áº¿n <strong>${deThi}</strong>.</p>
      <p><strong>Thá»i gian lÃ m bÃ i:</strong> 60 phÃºt</p>
      <p><strong>Tráº¡ng thÃ¡i:</strong> âœ… ÄÃ£ phÃª duyá»‡t</p>
    `;

    // Láº¥y dethiid tá»« madethi
    fetch('/exams')
      .then(res => res.json())
      .then(exams => {
        const exam = exams.find(e => e.madethi === deThi);
        if (!exam) {
          danhSach.innerHTML = "<li class='list-group-item text-danger'>KhÃ´ng tÃ¬m tháº¥y Ä‘á» thi.</li>";
          return;
        }
        // Gá»i API láº¥y cÃ¢u há»i theo dethiid
        fetch(`/questions/by_exam/${exam.dethiid}`)
          .then(res => res.json())
          .then(questions => {
            if (!questions.length) {
              danhSach.innerHTML = "<li class='list-group-item'>ChÆ°a cÃ³ dá»¯ liá»‡u cÃ¢u há»i.</li>";
            } else {
              danhSach.innerHTML = questions.map(q =>
                `<li class='list-group-item'>
                  <b>CÃ¢u há»i:</b> ${q.mota || '(KhÃ´ng cÃ³ mÃ´ táº£)'}<br>
                  <b>Má»©c Ä‘á»™:</b> ${q.mucdo || ''} | <b>ChÆ°Æ¡ng:</b> ${q.chuong || ''}
                </li>`
              ).join('');
            }
          })
          .catch(() => {
            danhSach.innerHTML = "<li class='list-group-item text-danger'>Lá»—i khi táº£i cÃ¢u há»i.</li>";
          });
      })
      .catch(() => {
        danhSach.innerHTML = "<li class='list-group-item text-danger'>Lá»—i khi táº£i Ä‘á» thi.</li>";
      });
  } else {
    thongTin.innerHTML =
      "<p class='text-danger'>KhÃ´ng tÃ¬m tháº¥y thÃ´ng tin Ä‘á» thi.</p>";
  }

  function suaDeThi() {
    alert("Chá»©c nÄƒng sá»­a Ä‘á» thi Ä‘ang Ä‘Æ°á»£c phÃ¡t triá»ƒn.");
  }

  function xoaDeThi() {
    const confirmDelete = confirm("Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a Ä‘á» thi nÃ y?");
    if (confirmDelete) {
      alert("ÄÃ£ xÃ³a Ä‘á» thi (mÃ´ phá»ng).");
      window.location.href = "/bomon";
    }
  }
</script>
{% endblock %}